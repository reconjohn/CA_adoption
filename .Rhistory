peer_IC = ifelse(peer_IC %in% c("not-specific","coworker", "acquaintance"), "peer", peer_IC),
peer_IC = factor(peer_IC, levels = c("neighbor","peer","none")),
peer_HP = ifelse(str_detect(elec_home_who_3, "neighbor"), "neighbor",
ifelse(str_detect(elec_home_who_3, "coworker"), "coworker", "acquaintance")),
peer_HP = ifelse(is.na(peer_HP), "none", peer_HP),
peer_HP = ifelse(peer_HP == "none" & elec_home_others_3 == "Yes", "not-specific", peer_HP),
peer_HP = ifelse(peer_HP %in% c("not-specific","coworker", "acquaintance"), "peer", peer_HP),
peer_HP = factor(peer_HP, levels = c("neighbor","peer","none")),
peer_PV = ifelse(str_detect(elec_home_who_4, "neighbor"), "neighbor",
ifelse(str_detect(elec_home_who_4, "coworker"), "coworker", "acquaintance")),
peer_PV = ifelse(is.na(peer_PV), "none", peer_PV),
peer_PV = ifelse(peer_PV == "none" & elec_home_others_4 == "Yes", "not-specific", peer_PV),
peer_PV = ifelse(peer_PV %in% c("not-specific","coworker", "acquaintance"), "peer", peer_PV),
peer_PV = factor(peer_PV, levels = c("neighbor","peer","none")),
# WTP
evupfront_num = case_when(vehicle_1_class == "Compact" ~ 27804,
vehicle_1_class == "Sedan " ~ 40380,
vehicle_1_class %in% c("SUV / Crossover SUV","Minivan") ~ 43990,
vehicle_1_class == "Truck" ~ 55177) %>% as.numeric(),
ev_wtp_pc = case_when(ev_wtp_pc == "always"~ 0,
ev_wtp_pc == "$2,000 in financial assistance"~ 2000,
ev_wtp_pc == "$4,000 in financial assistance"~ 4000,
ev_wtp_pc == "$6,000 in financial assistance"~ 6000,
ev_wtp_pc == "$8,000 in financial assistance"~ 8000,
ev_wtp_pc == "$10,000 in financial assistance"~ 10000,
ev_wtp_pc == "$12,500 in financial assistance"~ 12500,
ev_wtp_pc == "$15,000 in financial assistance"~ 15000,
ev_wtp_pc == "never"~ NA),
# ev_wtp_pc = factor(ev_wtp_pc, levels = data$ev_wtp_pc %>% unique() %>% .[c(8,4,10,7,1,2,6,5,9)]) %>%
#   as.numeric(),
ssupfront_num = str_remove_all(ss_upfr_text, "[^0-9]") %>% as.numeric(),
solstor_wtp_dv = case_when(solstor_wtp_dv == "always"~ 0,
solstor_wtp_dv == "$1,000 in financial assistance"~ 1000,
solstor_wtp_dv == "$2,000 in financial assistance"~ 2000,
solstor_wtp_dv == "$3,000 in financial assistance"~ 3000,
solstor_wtp_dv == "$5,000 in financial assistance"~ 5000,
solstor_wtp_dv == "$7,500 in financial assistance"~ 7500,
solstor_wtp_dv == "$10,000 in financial assistance"~ 10000,
solstor_wtp_dv == "$12,500 in financial assistance"~ 12500,
solstor_wtp_dv == "$15,000 in financial assistance"~ 15000,
solstor_wtp_dv == "$17,500 in financial assistance"~ 17500,
solstor_wtp_dv == "$20,000 in financial assistance"~ 20000,
solstor_wtp_dv == "$25,000 in financial assistance"~ 25000,
solstor_wtp_dv == "$30,000 in financial assistance"~ 30000,
solstor_wtp_dv == "never"~ NA),
#
# solstor_wtp_dv = case_when(solstor_wtp_dv == "always"~ 0,
#                            solstor_wtp_dv == "$1,000 in financial assistance"~ 1000,
#                            solstor_wtp_dv == "$2,000 in financial assistance"~ 2000,
#                            solstor_wtp_dv == "$3,000 in financial assistance"~ 3000,
#                            solstor_wtp_dv == "$5,000 in financial assistance"~ 5000,
#                            solstor_wtp_dv == "$7,500 in financial assistance"~ 7500,
#                            solstor_wtp_dv == "$10,000 in financial assistance"~ 10000,
#                            solstor_wtp_dv == "$12,500 in financial assistance"~ 12500,
#                            solstor_wtp_dv == "$15,000 in financial assistance"~ 15000,
#                            solstor_wtp_dv == "$17,500 in financial assistance"~ 17500,
#                            solstor_wtp_dv == "$20,000 in financial assistance"~ 20000,
#                            solstor_wtp_dv == "$25,000 in financial assistance"~ 25000,
#                            solstor_wtp_dv == "$30,000 in financial assistance"~ 30000,
#                            solstor_wtp_dv == "never"~ 35000),
# solstor_wtp_dv = factor(solstor_wtp_dv, levels = data$solstor_wtp_dv %>% unique() %>% .[c(5,9,8,10,13,12,14,3,2,6,7,15,4,11)]) %>%
#   as.numeric(),
solstor_wtp_payback = case_when(solstor_wtp_payback == "always"~ 0,
solstor_wtp_payback == "2 years to break even"~ 2,
solstor_wtp_payback == "4 years to break even"~ 4,
solstor_wtp_payback == "6 years to break even"~ 6,
solstor_wtp_payback == "8 years to break even"~ 8,
solstor_wtp_payback == "10 years to break even"~ 10,
solstor_wtp_payback == "15 years to break even"~ 15,
solstor_wtp_payback == "20 years to break even"~ 20,
solstor_wtp_payback == "never"~ 25),
# solstor_wtp_payback  = factor(solstor_wtp_payback , levels = data$solstor_wtp_payback  %>% unique() %>% .[c(2,10,9,4,5,3,6,8,7)]) %>%
#   as.numeric(),
hpupfront_num = case_when(home_area > 0 ~ 13000,
home_area > 1500 ~ 15000,
home_area > 2500 ~ 20000),
heatpump_wtp_pc = case_when(heatpump_wtp_pc == "always"~ 0,
heatpump_wtp_pc == "$2,000 in financial assistance"~ 2000,
heatpump_wtp_pc == "$4,000 in financial assistance"~ 4000,
heatpump_wtp_pc == "$6,000 in financial assistance"~ 6000,
heatpump_wtp_pc == "$8,000 in financial assistance"~ 8000,
heatpump_wtp_pc == "$10,000 in financial assistance"~ 10000,
heatpump_wtp_pc == "$12,500 in financial assistance"~ 12500,
heatpump_wtp_pc == "$15,000 in financial assistance"~ 15000,
heatpump_wtp_pc == "never"~ NA),
# heatpump_wtp_pc = factor(heatpump_wtp_pc, levels = data$heatpump_wtp_pc %>% unique() %>% .[c(1,6,10,7,5,2,3,8,9)]) %>%
#   as.numeric(),
heatpump_wtp_payback = case_when(heatpump_wtp_payback == "always"~ 0,
heatpump_wtp_payback == "3 years to break even"~ 3,
heatpump_wtp_payback == "5 years to break even"~ 5,
heatpump_wtp_payback == "7 years to break even"~ 7,
heatpump_wtp_payback == "9 years to break even"~ 9,
heatpump_wtp_payback == "11 years to break even"~ 11,
heatpump_wtp_payback == "13 years to break even"~ 13,
heatpump_wtp_payback == "15 years to break even"~ 15,
heatpump_wtp_payback == "never"~ 18),
# heatpump_wtp_payback = factor(heatpump_wtp_payback, levels = data$heatpump_wtp_payback %>% unique() %>% .[c(5,8,10,7,6,9,3,2,1)]) %>%
#   as.numeric(),
induction_dv = case_when(induction_dv == "always"~ 0,
induction_dv == "$100"~ 100,
induction_dv == "$200"~ 200,
induction_dv == "$300" ~ 300,
induction_dv == "$400"~ 400,
induction_dv == "$500" ~ 500,
induction_dv == "$600"~ 600,
induction_dv == "$700" ~ 700,
induction_dv == "$800" ~ 800,
induction_dv == "$900" ~ 900,
induction_dv == "$1000" ~ 1000,
induction_dv == "never" ~ NA),
# induction_dv = factor(induction_dv, levels = data$induction_dv %>% unique() %>% .[c(5,7,12,11,9,10,3,2,13,6,8)]) %>%
#   as.numeric(),
# climate change
yale_worried = factor(yale_worried, levels = data$yale_worried %>% unique() %>% .[c(4,2,3,1)]) %>%
as.numeric(),
cclive = factor(cclive, levels = data$cclive %>% unique() %>% .[c(2,3,4,1)]) %>%
as.numeric(),
ccpastmove = factor(ccpastmove, levels = data$ccpastmove %>% unique() %>% .[c(1,3,2)]) %>%
as.numeric(),
ccfuturemove = factor(ccfuturemove, levels = data$ccfuturemove %>% unique() %>% .[c(1,2,4,3)]) %>%
as.numeric(),
homevac = factor(homevac, levels = data$homevac %>% unique() %>% .[c(2,1,3)]) %>%
as.numeric(),
ccmove_where = ifelse(ccmove_where == "Move to a different state", 1, 0),
### additional variables
cost_fuel_winter = case_when(cost_fuel_winter == "$0-25 per month" ~ 12.5,
cost_fuel_winter == "$25-50 per month" ~ 37.5,
cost_fuel_winter == "$50-100 per month" ~ 75,
cost_fuel_winter == "$100-199 per month" ~ 150,
cost_fuel_winter == "$200-299 per month" ~ 250,
cost_fuel_winter == "$300-399 per month" ~ 350,
cost_fuel_winter == "$400-499 per month" ~ 450,
cost_fuel_winter == "$500-599 per month" ~ 550,
cost_fuel_winter == "$600-699 per month" ~ 650,
cost_fuel_winter == "$700-799 per month" ~ 750,
cost_fuel_winter == "$800 or more per month" ~ 850,
cost_fuel_winter == "I do not know or remember" ~ NA),
cost_electric_winter = case_when(cost_electric_winter == "$0-25 per month" ~ 12.5,
cost_electric_winter == "$25-50 per month" ~ 37.5,
cost_electric_winter == "$50-100 per month" ~ 75,
cost_electric_winter == "$100-199 per month" ~ 150,
cost_electric_winter == "$200-299 per month" ~ 250,
cost_electric_winter == "$300-399 per month" ~ 350,
cost_electric_winter == "$400-499 per month" ~ 450,
cost_electric_winter == "$500-599 per month" ~ 550,
cost_electric_winter == "$600-699 per month" ~ 650,
cost_electric_winter == "$700-799 per month" ~ 750,
cost_electric_winter == "$800 or more per month" ~ 850,
cost_electric_winter == "I do not know or remember" ~ NA),
cost_combo_winter_summed = cost_fuel_winter + cost_electric_winter,
cost_combo_winter = case_when(cost_combo_winter == "$0-25 per month" ~ 12.5,
cost_combo_winter == "$25-50 per month" ~ 37.5,
cost_combo_winter == "$50-100 per month" ~ 75,
cost_combo_winter == "$100-199 per month" ~ 150,
cost_combo_winter == "$200-299 per month" ~ 250,
cost_combo_winter == "$300-399 per month" ~ 350,
cost_combo_winter == "$400-499 per month" ~ 450,
cost_combo_winter == "$500-599 per month" ~ 550,
cost_combo_winter == "$600-699 per month" ~ 650,
cost_combo_winter == "$700-799 per month" ~ 750,
cost_combo_winter == "$800 or more per month" ~ 850,
cost_combo_winter == "I do not know or remember" ~ NA),
cost_combo_winter_final = coalesce(cost_combo_winter,cost_combo_winter_summed),
## summer energy costs
cost_combo_summer_final = coalesce(cost_electric_summer, cost_combo_summer),
cost_combo_summer_final = case_when(cost_combo_summer_final == "$0-25 per month" ~ 12.5,
cost_combo_summer_final == "$25-50 per month" ~ 37.5,
cost_combo_summer_final == "$50-100 per month" ~ 75,
cost_combo_summer_final == "$100-199 per month" ~ 150,
cost_combo_summer_final == "$200-299 per month" ~ 250,
cost_combo_summer_final == "$300-399 per month" ~ 350,
cost_combo_summer_final == "$400-499 per month" ~ 450,
cost_combo_summer_final == "$500-599 per month" ~ 550,
cost_combo_summer_final == "$600-699 per month" ~ 650,
cost_combo_summer_final == "$700-799 per month" ~ 750,
cost_combo_summer_final == "$800 or more per month" ~ 850,
cost_combo_summer_final == "I do not know or remember" ~ NA),
## age
age = case_when(age == "18 - 24" ~ 21,
age == "25 - 34" ~ 30,
age == "35 - 44" ~ 40,
age == "45 - 54" ~ 50,
age == "55 - 64" ~ 60,
age == "65 - 74" ~ 70,
age == "75 - 84" ~ 80,
age == "85 or older" ~ 90),
## gender
gender = case_when(gender == "I want to self-identify" ~ "Other",
.default = gender),
## home_own
home_own = ifelse(home_own == "Yes", 1, 0),
## ac_unit_number
ac_unit_number = case_when(ac_unit_number == "1" ~ 1,
ac_unit_number == "2" ~ 2,
ac_unit_number == "3" ~ 3,
ac_unit_number == "4" ~ 4,
ac_unit_number == "5 or more" ~ 5,
.default = NA),
# vehicle_num
vehicle_num = case_when(vehicle_num == "1" ~ 1,
vehicle_num == "2" ~ 2,
vehicle_num == "3" ~ 3,
vehicle_num == "4 or more vehicles" ~ 4,
.default = NA),
# vehicle_2_miles
vehicle_2_miles = case_when(vehicle_2_miles == "Less than 2,500 miles per year"~ 1250,
vehicle_2_miles == "2,500 - 4,999 miles per year"~ 3750,
vehicle_2_miles == "5,000 - 7,499 miles per year"~ 6250,
vehicle_2_miles == "7,500 - 9,999 miles per year"~ 8750,
vehicle_2_miles == "10,000 - 12,499 miles per year"~ 11250,
vehicle_2_miles == "12,500 - 14,999 miles per year"~ 13750,
vehicle_2_miles == "15,000 - 17,499 miles per year"~ 16250,
vehicle_2_miles == "17,500 - 20,000 miles per year"~ 18750,
vehicle_2_miles == "More than 20,000 miles per year"~ 25000,
.default = 0),
## vehicle_comb_miles
vehicle_comb_miles = vehicle_1_miles + vehicle_2_miles,
## fastcharge_likely
fastcharge_likely = case_when(fastcharge_likely == "No, not more likely at all"~ 1,
fastcharge_likely == "Only a little more likely" ~ 2,
fastcharge_likely == "Somewhat more likely" ~ 3,
fastcharge_likely == "Much more likely" ~ 4,
.default = NA),
# lowincome_sup
lowincome_sup = case_when(lowincome_sup == "Yes"~ 1,
lowincome_sup == "No" ~ 0,
lowincome_sup == "I don't know" ~ 0,
.default = NA),
# elec_avail
elec_avail = case_when(elec_avail == "Very confident"~ 4,
elec_avail == "Somewhat confident" ~ 3,
elec_avail == "Not too confident" ~ 2,
elec_avail == "Not confident at all" ~ 1,
.default = NA),
# hvac_avail
hvac_avail = case_when(hvac_avail == "Very confident"~ 4,
hvac_avail == "Somewhat confident" ~ 3,
hvac_avail == "Not too confident" ~ 2,
hvac_avail == "Not confident at all" ~ 1,
.default = NA),
# ccinsure_owner
ccinsure_owner = ifelse(ccinsure_owner == "Yes", 1, 0),
# ccinsure_renter
ccinsure_renter = ifelse(ccinsure_renter == "Yes", 1, 0),
## ccinsure_both
ccinsure_both = coalesce(ccinsure_owner, ccinsure_renter),
# ccinsure_lost
ccinsure_lost = ifelse(ccinsure_lost == "Yes", 1, 0),
# pid
pid_composite = case_when(pid == "Democrat" & pid_dem == "Strong Democrat" ~ 1,
pid == "Democrat" & pid_dem == "Not a very strong Democrat" ~ 2,
pid == "Independent" & pid_ind == "Closer to the Democratic Party" ~ 3,
pid == "Something else" & pid_ind == "Closer to the Democratic Party" ~ 3,
pid == "Independent" & pid_ind == "No, neither party" ~ 4,
pid == "Something else" & pid_ind == "No, neither party" ~ 4,
pid == "Something else" & pid_ind == "Closer to the Republican Party" ~ 5,
pid == "Independent" & pid_ind == "Closer to the Republican Party" ~ 5,
pid == "Republican" & pid_rep == "Not a very strong Republican" ~ 6,
pid == "Republican" & pid_rep == "Strong Republican" ~ 7,
pid == "I am not eligible to vote" ~ NA,
.default = NA),
## thermostat use:
therm_summer = case_when(str_detect(therm_summer, "60|61|62") ~ 1,
str_detect(therm_summer, "63|64|65") ~ 2,
str_detect(therm_summer, "66|67|68") ~ 3,
str_detect(therm_summer, "69|70|71") ~ 4,
str_detect(therm_summer, "72|73|74") ~ 5,
str_detect(therm_summer, "75|76|77") ~ 6,
str_detect(therm_summer, "78|79|80|I do not") ~ 7,
.default = NA),
therm_winter = case_when(str_detect(therm_winter, "60|61|62|I do not") ~ 1,
str_detect(therm_winter, "63|64|65") ~ 2,
str_detect(therm_winter, "66|67|68") ~ 3,
str_detect(therm_winter, "69|70|71") ~ 4,
str_detect(therm_winter, "72|73|74") ~ 5,
str_detect(therm_winter, "75|76|77") ~ 6,
str_detect(therm_winter, "78|79|80") ~ 7,
.default = NA)
)
}
data_clean <- function(data, further = NULL){
dat <- data %>%
data_cl()
# ### Imputation
# imp <- lm(solstor_wtp_dv ~ income+race+pid+employment+home_type+home_age+kitchen_range_type+primary_cooling_type+
#             primary_heating_type+PV+peer_PV, dat %>%
#             filter(!is.na(solstor_wtp_dv)))
# # summary(imp)
# missing_rows <- which(is.na(dat$solstor_wtp_dv))
# estimated_value <- predict(imp, newdata = dat[missing_rows, ])
# dat$solstor_wtp_dv[missing_rows] <- estimated_value
#
# imp <- lm(heatpump_wtp_pc ~ income+race+pid+employment+home_type+home_age+kitchen_range_type+primary_cooling_type+
#             HP+peer_HP, dat %>%
#             filter(!is.na(heatpump_wtp_pc)))
# # summary(imp)
# missing_rows <- which(is.na(dat$heatpump_wtp_pc))
# estimated_value <- predict(imp, newdata = dat[missing_rows, ])
# dat$heatpump_wtp_pc[missing_rows] <- estimated_value
# rows <- which(dat$heatpump_wtp_pc<0)
# dat$heatpump_wtp_pc[rows] <- 0
#
# imp <- lm(induction_dv ~ income+race+pid+employment+home_type+home_age+primary_cooling_type+
#             primary_heating_type+IC+peer_IC, dat %>%
#             filter(!is.na(induction_dv)))
# # summary(imp)
# missing_rows <- which(is.na(dat$induction_dv))
# estimated_value <- predict(imp, newdata = dat[missing_rows, ])
# dat$induction_dv[missing_rows] <- estimated_value
dat <- dat %>%
mutate(
# future adoption
# future_EV10 = ifelse((vehicle_next_when > 1 & vehicle_next_fuel == 1)| EV == 1, 1, 0),
future_EV_0 = ifelse((vehicle_next_when == 1 & vehicle_next_fuel == 1 &
ev_wtp_pc == 0)| EV == 1, 1, 0),
future_EV_low = ifelse((vehicle_next_when == 1 & vehicle_next_fuel == 1 &
ev_wtp_pc <= 8000)| EV == 1, 1, 0),
future_EV_high = ifelse((vehicle_next_when == 1 & vehicle_next_fuel == 1 &
ev_wtp_pc <= 12500)| EV == 1, 1, 0),
future_PV = ifelse(solar_pv_plans %in% c("Yes", "Maybe") | PV == 1, 1, 0),
future_PS_0 = ifelse((storage_plans %in% c("Yes", "Maybe") & solstor_wtp_dv == 0) |
(solar_pv_plans %in% c("Yes", "Maybe") & solstor_wtp_dv == 0) |
PS == 1, 1, 0),
future_PS_low = ifelse((storage_plans %in% c("Yes", "Maybe") & solstor_wtp_dv <= 5000) |
(solar_pv_plans %in% c("Yes", "Maybe") & solstor_wtp_dv <= 5000) |
PS == 1, 1, 0),
future_PS_high = ifelse((storage_plans %in% c("Yes", "Maybe") & solstor_wtp_dv <= 12500) |
(solar_pv_plans %in% c("Yes", "Maybe") & solstor_wtp_dv <= 12500) |
PS == 1, 1, 0),
future_HP_0 = ifelse(heatpump_direct == 1 &
heatpump_wtp_pc == 0| HP == 1, 1, 0),
future_HP_low = ifelse(heatpump_direct == 1 &
heatpump_wtp_pc <= 4000| HP == 1, 1, 0),
future_HP_high = ifelse(heatpump_direct == 1 &
heatpump_wtp_pc <= 8000| HP == 1, 1, 0),
future_IC_0 = ifelse(induction_direct == 1 &
induction_dv == 0| IC == 1, 1, 0),
future_IC_low = ifelse(induction_direct == 1 &
induction_dv <= 300| IC == 1, 1, 0),
future_IC_high = ifelse(induction_direct == 1 &
induction_dv <= 800| IC == 1, 1, 0)
) %>%
# mutate(across(matches("future"), ~ ifelse(is.na(.), 0, .))) %>%
# remove variables
dplyr::select(-pid,-pid_dem,-pid_ind,-pid_rep,
-solar_install_owner,-solar_install_renter,-solar_install,-solar_date_owner,-solar_pv_plans,-storage_plans,-storage_own,
-vehicle_1_miles,-vehicle_2_miles,-workfromhome,-vehicle_charging_own:-charging_install,-fastcharge_likely,
-charging_5mile_non_1:-charging_5mile_own_2,
-vehicle_wherecharge_1,-vehicle_wherecharge_2,-vehicle_wherecharge_3,-vehicle_whencharge,
-vehicle_next_fuel,
-replan_heat_owner:-replan_nocool_renter,-elec_savemoney_rent,-elec_health_renter,
-natgas_ypccc,
-elec_home_cost_1:-elec_home_cost_4,-elec_home_others_1:-elec_home_who_4,
-heatpump_motiv,-induction_appeal,-induction_downsides,
-cost_fuel_winter,-cost_electric_winter,-cost_combo_winter_summed,-cost_combo_winter,
-cost_combo_summer,-cost_electric_summer,
-ccinsure_owner,-ccinsure_renter,
-elec_home_cost_PV,
-elec_home_cost_EV,-vehicle_next_when,-vehicle_1_class,
-elec_home_cost_HP,-elec_home_cost_IC,
-cooling_plan,-heating_plan,
-solstor_wtp_payback,-heatpump_wtp_payback,-ss_upfr_text,-ssupfront_num,-hpupfront_num,-evupfront_num,
-primary_cooling_type_25_TEXT,-primary_heating_type_64_TEXT,-heatenergy_furnace,-heatenergy_boiler,-hotwater_energy_6_TEXT,
-heatpump_adopter
# -future_EV10
) %>%
relocate(wt_ca, .after = last_col()) %>%
relocate(tractid, .after = last_col())
if(!is.null(further)){ # after ML
dat <- dat %>%
# left_join(psps, by = c("tractid" = "GEOID")) %>%
# left_join(charge, by = c("tractid" = "GEOID")) %>%
dplyr::select(-ExternalReference, -tractid,
# remove NAs
-induction_direct, -heatpump_direct, -ac_unit_number,-hotwater_nextelec,
# remove not significant or collinear variables
-charging_access,-charging_5mile_r, -ccinsure_both,-yale_worried,-ideology,-hvac_avail
# -charging_work, -vehicle_num,
# -born_us, -employment, -education, -race, -gender, -lowincome_sup,
# -elec_health, -upfrontpayback, -elec_safety, -ccinsure_lost,
# -ccpastmove, -elec_avail, -ccmove_where, -homevac
) %>%
relocate(wt_ca, .after = last_col())
}
return(dat)
}
names(data)
data %>% dplyr::select(home_own,future_HP_0,future_HP_low,future_HP_high) %>% View
data %>% dplyr::select(home_own,future_HP_0,future_HP_low,future_HP_high) %>%
lapply(mean)
data %>% dplyr::select(home_own,future_HP_0,future_HP_low,future_HP_high) %>%
lapply(mean, na.rm = T)
data_clean <- function(data, further = NULL){
dat <- data %>%
data_cl()
# ### Imputation
# imp <- lm(solstor_wtp_dv ~ income+race+pid+employment+home_type+home_age+kitchen_range_type+primary_cooling_type+
#             primary_heating_type+PV+peer_PV, dat %>%
#             filter(!is.na(solstor_wtp_dv)))
# # summary(imp)
# missing_rows <- which(is.na(dat$solstor_wtp_dv))
# estimated_value <- predict(imp, newdata = dat[missing_rows, ])
# dat$solstor_wtp_dv[missing_rows] <- estimated_value
#
# imp <- lm(heatpump_wtp_pc ~ income+race+pid+employment+home_type+home_age+kitchen_range_type+primary_cooling_type+
#             HP+peer_HP, dat %>%
#             filter(!is.na(heatpump_wtp_pc)))
# # summary(imp)
# missing_rows <- which(is.na(dat$heatpump_wtp_pc))
# estimated_value <- predict(imp, newdata = dat[missing_rows, ])
# dat$heatpump_wtp_pc[missing_rows] <- estimated_value
# rows <- which(dat$heatpump_wtp_pc<0)
# dat$heatpump_wtp_pc[rows] <- 0
#
# imp <- lm(induction_dv ~ income+race+pid+employment+home_type+home_age+primary_cooling_type+
#             primary_heating_type+IC+peer_IC, dat %>%
#             filter(!is.na(induction_dv)))
# # summary(imp)
# missing_rows <- which(is.na(dat$induction_dv))
# estimated_value <- predict(imp, newdata = dat[missing_rows, ])
# dat$induction_dv[missing_rows] <- estimated_value
dat <- dat %>%
mutate(
# future adoption
# future_EV10 = ifelse((vehicle_next_when > 1 & vehicle_next_fuel == 1)| EV == 1, 1, 0),
future_EV_0 = ifelse((vehicle_next_when == 1 & vehicle_next_fuel == 1 &
ev_wtp_pc == 0)| EV == 1, 1, 0),
future_EV_low = ifelse((vehicle_next_when == 1 & vehicle_next_fuel == 1 &
ev_wtp_pc <= 8000)| EV == 1, 1, 0),
future_EV_high = ifelse((vehicle_next_when == 1 & vehicle_next_fuel == 1 &
ev_wtp_pc <= 12500)| EV == 1, 1, 0),
future_PV = ifelse(solar_pv_plans %in% c("Yes", "Maybe") | PV == 1, 1, 0),
future_PS_0 = ifelse((storage_plans %in% c("Yes", "Maybe") & solstor_wtp_dv == 0) |
(solar_pv_plans %in% c("Yes", "Maybe") & solstor_wtp_dv == 0) |
PS == 1, 1, 0),
future_PS_low = ifelse((storage_plans %in% c("Yes", "Maybe") & solstor_wtp_dv <= 5000) |
(solar_pv_plans %in% c("Yes", "Maybe") & solstor_wtp_dv <= 5000) |
PS == 1, 1, 0),
future_PS_high = ifelse((storage_plans %in% c("Yes", "Maybe") & solstor_wtp_dv <= 12500) |
(solar_pv_plans %in% c("Yes", "Maybe") & solstor_wtp_dv <= 12500) |
PS == 1, 1, 0),
future_HP_0 = ifelse(heatpump_direct == 1 &
heatpump_wtp_pc == 0| HP == 1, 1, 0),
future_HP_low = ifelse(heatpump_direct == 1 &
heatpump_wtp_pc <= 4000| HP == 1, 1, 0),
future_HP_high = ifelse(heatpump_direct == 1 &
heatpump_wtp_pc <= 8000| HP == 1, 1, 0),
future_IC_0 = ifelse(induction_direct == 1 &
induction_dv == 0| IC == 1, 1, 0),
future_IC_low = ifelse(induction_direct == 1 &
induction_dv <= 300| IC == 1, 1, 0),
future_IC_high = ifelse(induction_direct == 1 &
induction_dv <= 800| IC == 1, 1, 0)
) %>%
# mutate(across(matches("future"), ~ ifelse(is.na(.), 0, .))) %>%
# remove variables
dplyr::select(-pid,-pid_dem,-pid_ind,-pid_rep,
-solar_install_owner,-solar_install_renter,-solar_install,-solar_date_owner,-solar_pv_plans,-storage_plans,-storage_own,
-vehicle_1_miles,-vehicle_2_miles,-workfromhome,-vehicle_charging_own:-charging_install,-fastcharge_likely,
-charging_5mile_non_1:-charging_5mile_own_2,
-vehicle_wherecharge_1,-vehicle_wherecharge_2,-vehicle_wherecharge_3,-vehicle_whencharge,
-vehicle_next_fuel,
-replan_heat_owner:-replan_nocool_renter,-elec_savemoney_rent,-elec_health_renter,
-natgas_ypccc,
-elec_home_cost_1:-elec_home_cost_4,-elec_home_others_1:-elec_home_who_4,
-heatpump_motiv,-induction_appeal,-induction_downsides,
-cost_fuel_winter,-cost_electric_winter,-cost_combo_winter_summed,-cost_combo_winter,
-cost_combo_summer,-cost_electric_summer,
-ccinsure_owner,-ccinsure_renter,
-elec_home_cost_PV,
-elec_home_cost_EV,-vehicle_next_when,-vehicle_1_class,
-elec_home_cost_HP,-elec_home_cost_IC,
-cooling_plan,-heating_plan,
-solstor_wtp_payback,-heatpump_wtp_payback,-ss_upfr_text,-ssupfront_num,-hpupfront_num,-evupfront_num,
-primary_cooling_type_25_TEXT,-primary_heating_type_64_TEXT,-heatenergy_furnace,-heatenergy_boiler,-hotwater_energy_6_TEXT,
-heatpump_adopter
# -future_EV10
) %>%
relocate(wt_ca, .after = last_col()) %>%
relocate(tractid, .after = last_col())
if(!is.null(further)){ # after ML
dat <- dat %>%
# left_join(psps, by = c("tractid" = "GEOID")) %>%
# left_join(charge, by = c("tractid" = "GEOID")) %>%
dplyr::select(-ExternalReference, -tractid,
# remove NAs
-induction_direct, -heatpump_direct, -ac_unit_number,-hotwater_nextelec,
# remove not significant or collinear variables
-charging_access,-charging_5mile_r, -ccinsure_both,-yale_worried,-ideology,-hvac_avail
# -charging_work, -vehicle_num,
# -born_us, -employment, -education, -race, -gender, -lowincome_sup,
# -elec_health, -upfrontpayback, -elec_safety, -ccinsure_lost,
# -ccpastmove, -elec_avail, -ccmove_where, -homevac
) %>%
relocate(wt_ca, .after = last_col())
}
return(dat)
}
data <- read_csv("./data/raw/cca_15jul2025_weighted.csv") %>% data_process(ev = c("Fully electric")) %>% data_clean(1) %>%
dplyr::select(-c("cost_combo_winter_final","cost_combo_summer_final"),
-c("solstor_wtp_dv","ev_wtp_pc","heatpump_wtp_pc","induction_dv","solstor_wtp_dv"))
data %>% dplyr::select(home_own,future_HP_0,future_HP_low,future_HP_high) %>%
lapply(mean, na.rm = T)
data %>% dplyr::select(home_own,future_HP_0,future_HP_low,future_HP_high) %>% View
data %>% dplyr::select(home_own,future_HP_0,future_HP_low,future_HP_high,heatpump_direct) %>% View
names(data)
data <- read_csv("./data/raw/cca_15jul2025_weighted.csv") %>% data_process(ev = c("Fully electric")) %>% data_clean() %>%
dplyr::select(-c("cost_combo_winter_final","cost_combo_summer_final"),
-c("solstor_wtp_dv","ev_wtp_pc","heatpump_wtp_pc","induction_dv","solstor_wtp_dv"))
names(data)
data %>% dplyr::select(home_own,future_HP_0,future_HP_low,future_HP_high,heatpump_direct) %>% View
data %>% dplyr::select(home_own,future_HP_0,future_HP_low,future_HP_high,heatpump_direct,HP) %>% View
